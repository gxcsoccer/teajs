/*! teajs 2013-08-29 */
define("customize/app",["widget/WaterfallWidget","commonui/waterfall/Waterfall","core/view/View","core/event/EventEmitter","juicer"],function(a){"use strict";a("css/test.css");var b=a("widget/WaterfallWidget"),c=new b(null,{colWidth:200,rowHeight:200,queryFunction:function(a,b){return $.Deferred(function(c){for(var d=[],e=0;b>e&&20>a+e;e++)d.push(a+e);c.resolve({list:d})}).promise()},createItem:function(a){return $('<li class="ui-waterfall-item"><div>'+a+"</div></li>")},pivot:"middle"});c.show();var d={37:"LEFT_KEY",39:"RIGHT_KEY",38:"UP_KEY",40:"DOWN_KEY"};window.onkeydown=function(a){var b=a.which;console.log(b),c.dispatchEvent({type:d[b]})}}),define("css/test.css",[],function(){seajs.importStyle(".ui-viewport{position:relative;width:1000px;height:600px;overflow:hidden}.ui-waterfall{position:absolute;width:100%;-webkit-transition:-webkit-transform .6s}.ui-waterfall-item{position:absolute;width:200px;height:200px}.ui-waterfall-item>div{position:absolute;top:10px;left:10px;width:180px;height:180px;background:red}.ui-waterfall-item.focused>div{box-shadow:0 0 20px 5px #00f}ul{list-style:none;margin:0;padding:0}")}),define(["commonui/waterfall/Waterfall","core/view/View","core/event/EventEmitter","juicer"],function(a){"use strict";var b=a("commonui/waterfall/Waterfall"),c=a("core/view/View"),d=a("core/event/EventEmitter"),e=a("juicer"),f=e('<div class="ui-viewport"><ul class="ui-waterfall"></ul></div>',{});return c.extend({onInit:function(a){this.pivot=a.pivot||"edge",this.$el.html(f),this.$waterfall=this.$(".ui-waterfall"),this.$viewport=this.$(".ui-viewport"),this.containerHeight=this.$viewport.height();var c=Math.ceil(this.containerHeight/a.rowHeight);this.waterfall=new b({$el:this.$(".ui-waterfall"),colWidth:a.colWidth,queryFunction:a.queryFunction,createItem:a.createItem,preloadRow:c,rowHeight:a.rowHeight}),this.__defineGetter__("offsetTop",function(){return this._offsetTop||0}),this.__defineSetter__("offsetTop",function(a){this._offsetTop=a,this.$waterfall.css("transform","translate3d(0,"+a+"px,0)")});var d={edge:function(a,b){var c=b>1?(b-1)*this.waterfall.rowHeight:0,d=b*this.waterfall.rowHeight;d>this.containerHeight-this.offsetTop?this.offsetTop=this.containerHeight-d:c<-this.offsetTop&&(this.offsetTop=-c)}.bind(this),middle:function(a,b){var d=Math.ceil(this.containerHeight/(2*this.waterfall.rowHeight)),e=this.waterfall.noMoreData,f=Math.ceil(this.waterfall.dataList.length/this.waterfall.colCount);this.offsetTop=d>b?0:e&&c-d>f-b?(c-f-d+2)*this.waterfall.rowHeight:(d-b)*this.waterfall.rowHeight}.bind(this)};this.waterfall.on("indexChanged",function(a){var b=this.waterfall.getView(a),c=this.waterfall.getCurrentView();b&&b.removeClass("focused"),c&&c.addClass("focused")},this),this.waterfall.on("rowChanged",d[this.pivot],this),this.waterfall.show(0,15,0)},handleEvent:function(a){switch(a.type){case"LEFT_KEY":this.waterfall.previous();break;case"RIGHT_KEY":this.waterfall.next();break;case"UP_KEY":this.waterfall.previousRow();break;case"DOWN_KEY":this.waterfall.nextRow();break;default:return 0}return 1}}).implement([d])}),define(["core/class/Class","core/event/EventEmitter","core/util/Utils"],function(a){var b=a("core/class/Class"),c=a("core/event/EventEmitter"),d=a("core/util/Utils").timedChunk,e={colWidth:200,createItem:function(){},queryFunction:function(){return $.Deferred(function(a){a.resolve({list:[]})})},preloadRow:1};return b.extend({init:function(a){$.extend(this,e,a),this.reset(),this.__defineGetter__("currentIndex",function(){return this._currentIndex}),this.__defineSetter__("currentIndex",function(a){var b=this._currentIndex,c=null!=b&&Math.ceil((b+1)/this.colCount),d=Math.ceil((a+1)/this.colCount),e=this.dataList.length;this._currentIndex=a,b!==a&&this.trigger("indexChanged",b,a),c!==d&&this.trigger("rowChanged",c,d),b===a||this.isAdding||this.isAdjusting||this.noMoreData||this.isQuerying||(d+this.preloadRow)*this.colCount>e&&this.loadMore(e,this.colCount)}),this.__defineGetter__("currentRow",function(){return Math.ceil((this.currentIndex+1)/this.colCount)}),this.__defineGetter__("isAdding",function(){return!!this._adder}),this.__defineGetter__("isAdjusting",function(){return!!this._adjuster})},loadMore:function(a,b){return a=a||0,b=b||-1,this.isQuerying=!0,this.queryFunction(a,b).done(function(a){this.isQuerying=!1;var c,d=a.list||[];(0===d.length||b>0&&d.length<b)&&(this.noMoreData=!0),this.dataList=this.dataList.concat(d),c=d.map(function(a){return this.createItem(a)}.bind(this)),this.addItems(c)}.bind(this))},show:function(a,b,c){this.reset(),this.$el.show(),this.recalculate(),this.loadMore(a,b).done(function(a){a&&0==a.list.length?this.emit("noData"):null!=c&&(this.currentIndex=c)}.bind(this))},hide:function(){this.$el.hide()},reset:function(){this.viewList=[],this.dataList=[],this.noMoreData=!1,this.currentIndex=null,this.$el.empty()},next:function(){null!=this.currentIndex&&(this.currentIndex=this.currentIndex<this.dataList.length-1?this.currentIndex+1:this.dataList.length-1)},previous:function(){null!=this.currentIndex&&(this.currentIndex=this.currentIndex>0?this.currentIndex-1:0)},nextRow:function(){null!=this.currentIndex&&(this.currentIndex=this.currentIndex+this.colCount<this.dataList.length-1?this.currentIndex+this.colCount:this.dataList.length-1)},previousRow:function(){null!=this.currentIndex&&(this.currentIndex=this.currentIndex-this.colCount>0?this.currentIndex-this.colCount:0)},recalculate:function(){this.containerWidth=this.$el.width(),this.colItems=[],this.curColHeights=[],this.colCount=Math.max(1,Math.floor(this.containerWidth/(0==this.colWidth?1:this.colWidth)));for(var a=0;a<this.colCount;a+=1)this.curColHeights[a]=0},getData:function(a){return this.dataList[a]},getCurrentData:function(){return this.dataList[this.currentIndex]},getView:function(a){return this.viewList[a]},getCurrentView:function(){return this.viewList[this.currentIndex]},addItems:function(a){return a=$.makeArray(a),this.viewList=this.viewList.concat(a),this._adder=d(a,function(a){this.placeItem(a,!0)},this),this._adder.start().done(function(){var a=Math.max.apply(Math,this.curColHeights);this.$el.height(a),this._adder=null}.bind(this))},placeItem:function(a,b){var c,d,e=$(a),f=this.curColHeights.length,g=0,h=Number.MAX_VALUE;if(f){for(var i=0;f>i;i+=1)this.curColHeights[i]<h&&(g=i,h=this.curColHeights[i]);b&&this.$el.append(e),c=g*this.colWidth,d=this.curColHeights[g],this.rowHeight?e.css({left:c,top:d,height:this.rowHeight}):e.css({left:c,top:d}),this.curColHeights[g]+=this.rowHeight||e.outerHeight(!0),this.colItems[g]=this.colItems[g]||[],this.colItems[g].push(e),e.attr({"data-waterfall-col":g,"data-waterfall-left":c,"data-waterfall-top":d})}},removeItem:function(a,b){return $.Deferred(function(c){var d=this.viewList[a],e=function(){d.remove(),this.viewList.splice(a,1),this.dataList.splice(a,1),a<=this.currentIndex&&(0==this.currentIndex?this.currentIndex=null:this.currentIndex--),this.adjust().done(function(){c.resolve()})}.bind(this);b?d.fadeOut().promise().done(e):e()}).promise()},adjust:function(){var a=this.$container.children(),b=a.length;if(b)return this.recalculate(),this.isAdjusting&&(this._adjuster.stop(),this._adjuster=0),this._adjuster=d(a,function(a){this.placeItem(a,!1)},this),this._adjuster.start().done(function(){var a=Math.max.apply(Math,this.curColHeights);this.$el.height(a),this._adjuster=null})}}).implement([c]).statics({get:function(a){return new this(a)}})}),define(["../class/Class","../event/EventEmitter","../util/Utils","juicer"],function(a){"use strict";var b=a("../class/Class"),c=a("../event/EventEmitter"),d=a("../util/Utils"),e=(a("juicer"),{$el:$(document.body),children:[]});return b.extend({template:"<div></div>",init:function(a,b){b=b||{},this.container=a||e,this.container.children.push(this),this.children=[],this.id=b.id||d.nextUid(),b.$el?this.$el=b.$el:(this.$el=this.makeElement(),this.attach()),this.show(),this.onInit(b)},onInit:function(){},$:function(a){return this.$el.find(a)},makeElement:function(){return $(this.template,{id:this.id})},attach:function(){$.contains(this.container.$el[0],this.$el[0])||this.container.$el.append(this.$el)},detach:function(){this.$el.remove()},show:function(){this.$el.show(),this.active()},hide:function(){this.$el.hide(),this.deactive()},active:function(){this.isActive=!0},deactive:function(){this.isActive=!1},dispatchEvent:function(a){if(!this.isActive)return 0;var b=0;return $.each(this.children,function(c,d){return b=d.dispatchEvent(a),0===b}),b||this.handleEvent(a)},handleEvent:function(){return 0},destory:function(){this.detach();var a=this.container.children.indexOf(this);a>=0&&this.container.children.splice(a,1),this.children.forEach(function(a){a.destory()}),this.onDestory()},onDestory:function(){}}).implement([c])}),define([],function(){"use strict";function a(){}function b(a,b,c){if(a){var d=0,e=a.length,f=b[0],g=b[1],h=b[2],i=!0;switch(b.length){case 0:for(;e>d;d+=2)i=a[d].call(a[d+1]||c)!==!1&&i;break;case 1:for(;e>d;d+=2)i=a[d].call(a[d+1]||c,f)!==!1&&i;break;case 2:for(;e>d;d+=2)i=a[d].call(a[d+1]||c,f,g)!==!1&&i;break;case 3:for(;e>d;d+=2)i=a[d].call(a[d+1]||c,f,g,h)!==!1&&i;break;default:for(;e>d;d+=2)i=a[d].apply(a[d+1]||c,b)!==!1&&i}}return i}var c=/\s+/;a.prototype.on=function(a,b,d){var e,f,g;if(!b)return this;for(e=this.__events||(this.__events={}),a=a.split(c);f=a.shift();)g=e[f]||(e[f]=[]),g.push(b,d);return this},a.prototype.off=function(a,b,e){var f,g,h,i;if(!(f=this.__events))return this;if(!(a||b||e))return delete this.__events,this;for(a=a?a.split(c):d(f);g=a.shift();)if(h=f[g])if(b||e)for(i=h.length-2;i>=0;i-=2)b&&h[i]!==b||e&&h[i+1]!==e||h.splice(i,2);else delete f[g];return this},a.prototype.trigger=function(a){var d,e,f,g,h,i,j=[],k=!0;if(!(d=this.__events))return this;for(a=a.split(c),h=1,i=arguments.length;i>h;h++)j[h-1]=arguments[h];for(;e=a.shift();)(f=d.all)&&(f=f.slice()),(g=d[e])&&(g=g.slice()),k=b(g,j,this)&&k,k=b(f,[e].concat(j),this)&&k;return k},a.prototype.emit=a.prototype.trigger,a.mixTo=function(b){b=b.prototype||b;var c=a.prototype;for(var d in c)c.hasOwnProperty(d)&&(b[d]=c[d])};var d=Object.keys;return d||(d=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}),a}),define([],function(a,b,c){var d=function(){var a=[].slice.call(arguments);return a.push(d.options),a[0].match(/^\s*#([\w:\-\.]+)\s*$/gim)&&a[0].replace(/^\s*#([\w:\-\.]+)\s*$/gim,function(b,c){var d=document,e=d&&d.getElementById(c);a[0]=e?e.value||e.innerHTML:b}),1==arguments.length?d.compile.apply(d,a):arguments.length>=2?d.to_html.apply(d,a):void 0},e={escapehash:{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;","/":"&#x2f;"},escapereplace:function(a){return e.escapehash[a]},escaping:function(a){return"string"!=typeof a?a:a.replace(/[&<>"]/gim,this.escapereplace)},detection:function(a){return"undefined"==typeof a?"":a}},f=function(a){if("undefined"!=typeof console){if(console.warn)return console.warn(a),void 0;if(console.log)return console.log(a),void 0}throw a},g=function(a,b){if(a=a!==Object(a)?{}:a,a.__proto__)return a.__proto__=b,a;var c=function(){},d=Object.create?Object.create(b):new(c.prototype=b,c);for(var e in a)a.hasOwnProperty(e)&&(d[e]=a[e]);return d};d.__cache={},d.version="0.6.5-stable",d.settings={},d.tags={operationOpen:"{@",operationClose:"}",interpolateOpen:"\\${",interpolateClose:"}",noneencodeOpen:"\\$\\${",noneencodeClose:"}",commentOpen:"\\{#",commentClose:"\\}"},d.options={cache:!0,strip:!0,errorhandling:!0,detection:!0,_method:g({__escapehtml:e,__throw:f,__juicer:d},{})},d.tagInit=function(){var a=d.tags.operationOpen+"each\\s*([^}]*?)\\s*as\\s*(\\w*?)\\s*(,\\s*\\w*?)?"+d.tags.operationClose,b=d.tags.operationOpen+"\\/each"+d.tags.operationClose,c=d.tags.operationOpen+"if\\s*([^}]*?)"+d.tags.operationClose,e=d.tags.operationOpen+"\\/if"+d.tags.operationClose,f=d.tags.operationOpen+"else"+d.tags.operationClose,g=d.tags.operationOpen+"else if\\s*([^}]*?)"+d.tags.operationClose,h=d.tags.interpolateOpen+"([\\s\\S]+?)"+d.tags.interpolateClose,i=d.tags.noneencodeOpen+"([\\s\\S]+?)"+d.tags.noneencodeClose,j=d.tags.commentOpen+"[^}]*?"+d.tags.commentClose,k=d.tags.operationOpen+"each\\s*(\\w*?)\\s*in\\s*range\\(([^}]+?)\\s*,\\s*([^}]+?)\\)"+d.tags.operationClose,l=d.tags.operationOpen+"include\\s*([^}]*?)\\s*,\\s*([^}]*?)"+d.tags.operationClose;d.settings.forstart=new RegExp(a,"igm"),d.settings.forend=new RegExp(b,"igm"),d.settings.ifstart=new RegExp(c,"igm"),d.settings.ifend=new RegExp(e,"igm"),d.settings.elsestart=new RegExp(f,"igm"),d.settings.elseifstart=new RegExp(g,"igm"),d.settings.interpolate=new RegExp(h,"igm"),d.settings.noneencode=new RegExp(i,"igm"),d.settings.inlinecomment=new RegExp(j,"igm"),d.settings.rangestart=new RegExp(k,"igm"),d.settings.include=new RegExp(l,"igm")},d.tagInit(),d.set=function(a,b){var c=this,d=function(a){return a.replace(/[\$\(\)\[\]\+\^\{\}\?\*\|\.]/gim,function(a){return"\\"+a})},e=function(a,b){var e=a.match(/^tag::(.*)$/i);return e?(c.tags[e[1]]=d(b),c.tagInit(),void 0):(c.options[a]=b,void 0)};if(2===arguments.length)return e(a,b),void 0;if(a===Object(a))for(var f in a)a.hasOwnProperty(f)&&e(f,a[f])},d.register=function(a,b){var c=this.options._method;return c.hasOwnProperty(a)?!1:c[a]=b},d.unregister=function(a){var b=this.options._method;return b.hasOwnProperty(a)?delete b[a]:void 0},d.template=function(a){var b=this;this.options=a,this.__interpolate=function(a,b,c){var d,e=a.split("|"),f=e[0]||"";return e.length>1&&(a=e.shift(),d=e.shift().split(","),f="_method."+d.shift()+".call({}, "+[a].concat(d)+")"),"<%= "+(b?"_method.__escapehtml.escaping":"")+"("+(c&&c.detection===!1?"":"_method.__escapehtml.detection")+"("+f+")"+")"+" %>"},this.__removeShell=function(a,c){var e=0;return a=a.replace(d.settings.forstart,function(a,b,c,d){var c=c||"value",d=d&&d.substr(1),f="i"+e++;return"<% ~function() {for(var "+f+" in "+b+") {"+"if("+b+".hasOwnProperty("+f+")) {"+"var "+c+"="+b+"["+f+"];"+(d?"var "+d+"="+f+";":"")+" %>"}).replace(d.settings.forend,"<% }}}(); %>").replace(d.settings.ifstart,function(a,b){return"<% if("+b+") { %>"}).replace(d.settings.ifend,"<% } %>").replace(d.settings.elsestart,function(){return"<% } else { %>"}).replace(d.settings.elseifstart,function(a,b){return"<% } else if("+b+") { %>"}).replace(d.settings.noneencode,function(a,d){return b.__interpolate(d,!1,c)}).replace(d.settings.interpolate,function(a,d){return b.__interpolate(d,!0,c)}).replace(d.settings.inlinecomment,"").replace(d.settings.rangestart,function(a,b,c,d){var f="j"+e++;return"<% ~function() {for(var "+f+"="+c+";"+f+"<"+d+";"+f+"++) {{"+"var "+b+"="+f+";"+" %>"}).replace(d.settings.include,function(a,b,c){return"<%= _method.__juicer("+b+", "+c+"); %>"}),c&&c.errorhandling===!1||(a="<% try { %>"+a,a+='<% } catch(e) {_method.__throw("Juicer Render Exception: "+e.message);} %>'),a},this.__toNative=function(a,b){return this.__convert(a,!b||b.strip)},this.__lexicalAnalyze=function(a){var b=[],c=[],e="",f=["if","each","_","_method","console","break","case","catch","continue","debugger","default","delete","do","finally","for","function","in","instanceof","new","return","switch","this","throw","try","typeof","var","void","while","with","null","typeof","class","enum","export","extends","import","super","implements","interface","let","package","private","protected","public","static","yield","const","arguments","true","false","undefined","NaN"],g=function(a,b){if(Array.prototype.indexOf&&a.indexOf===Array.prototype.indexOf)return a.indexOf(b);for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},h=function(a,e){if(e=e.match(/\w+/gim)[0],-1===g(b,e)&&-1===g(f,e)&&-1===g(c,e)){if("undefined"!=typeof window&&"function"==typeof window[e]&&window[e].toString().match(/^\s*?function \w+\(\) \{\s*?\[native code\]\s*?\}\s*?$/i))return a;if("undefined"!=typeof global&&"function"==typeof global[e]&&global[e].toString().match(/^\s*?function \w+\(\) \{\s*?\[native code\]\s*?\}\s*?$/i))return a;if("function"==typeof d.options._method[e]||d.options._method.hasOwnProperty(e))return c.push(e),a;b.push(e)}return a};a.replace(d.settings.forstart,h).replace(d.settings.interpolate,h).replace(d.settings.ifstart,h).replace(d.settings.elseifstart,h).replace(d.settings.include,h).replace(/[\+\-\*\/%!\?\|\^&~<>=,\(\)\[\]]\s*([A-Za-z_]+)/gim,h);for(var i=0;i<b.length;i++)e+="var "+b[i]+"=_."+b[i]+";";for(var i=0;i<c.length;i++)e+="var "+c[i]+"=_method."+c[i]+";";return"<% "+e+" %>"},this.__convert=function(a,b){var c=[].join("");return c+="'use strict';",c+="var _=_||{};",c+="var _out='';_out+='",c+=b!==!1?a.replace(/\\/g,"\\\\").replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"	").split("'").join("\\'").split("	").join("'").replace(/<%=(.+?)%>/g,"';_out+=$1;_out+='").split("<%").join("';").split("%>").join("_out+='")+"';return _out;":a.replace(/\\/g,"\\\\").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t").replace(/[\n]/g,"\\n").replace(/'(?=[^%]*%>)/g,"	").split("'").join("\\'").split("	").join("'").replace(/<%=(.+?)%>/g,"';_out+=$1;_out+='").split("<%").join("';").split("%>").join("_out+='")+"';return _out.replace(/[\\r\\n]\\s+[\\r\\n]/g, '\\r\\n');"},this.parse=function(a,c){var d=this;return c&&c.loose===!1||(a=this.__lexicalAnalyze(a)+a),a=this.__removeShell(a,c),a=this.__toNative(a,c),this._render=new Function("_, _method",a),this.render=function(a,c){return c&&c===b.options._method||(c=g(c,b.options._method)),d._render.call(this,a,c)},this}},d.compile=function(a,b){b&&b===this.options||(b=g(b,this.options));try{var c=this.__cache[a]?this.__cache[a]:new this.template(this.options).parse(a,b);return b&&b.cache===!1||(this.__cache[a]=c),c}catch(d){return f("Juicer Compile Exception: "+d.message),{render:function(){}}}},d.to_html=function(a,b,c){return c&&c===this.options||(c=g(c,this.options)),this.compile(a,c).render(b,c._method)},"undefined"!=typeof c&&c.exports?c.exports=d:this.juicer=d});
/*
//@ sourceMappingURL=build/teajs.map
*/